import{r as h,u as v,a as A,b as o,j as s,B as c,L as g}from"./index-DyOiOGPz.js";import{o as I,s as x,u as V,a as M,t as N,F as T,b as p,c as f,d as j,e as b,I as w,f as y}from"./use-alert-vNlQZNcX.js";import{C as O}from"./utils-CmQ-S6PF.js";import{u as R,a as P}from"./useLogin-BZNJzrtV.js";import{V as C}from"./verify-form-CwThCBhq.js";import"./fetch-GdoP7LyA.js";const G=I({username:x().min(2,{message:"Username phải có ít nhất 2 ký tự."}),password:x().min(6,{message:"Password phải có ít nhất 6 ký tự."})}),U=()=>{const[m,F]=h.useState(!1),i=v(),a=V(),{login:l}=A(),{login:S}=R(),{validLogin:k}=P(),r=M({resolver:N(G),defaultValues:{username:"",password:""}});h.useEffect(()=>{localStorage.getItem("token")&&i(o.HOMEPAGE)},[i]);async function d(t){var n,u;try{const e=await S(t.username,t.password);if(!(e!=null&&e.success)){a.error("Lỗi",e==null?void 0:e.message);return}if(!(e!=null&&e.success)||!(e!=null&&e.success)&&!m){F(!0),a.success("Thông báo",e==null?void 0:e.message);return}e!=null&&e.data&&(a.success("Thông báo",e==null?void 0:e.message),l(e==null?void 0:e.data)),Number((u=(n=e==null?void 0:e.data)==null?void 0:n.userInfo)==null?void 0:u.VerifiedEmail)===0?i(o.VERIFy_EMAIL):i(o.HOMEPAGE)}catch{a.error("Lỗi","Đăng nhập thất bại. Vui lòng kiểm tra lại thông tin.")}}const E=async t=>{try{const n=await k({code:t});if(n)l(n),i(o.HOMEPAGE);else throw new Error("Mã xác thực không đúng")}catch(n){a.error("Lỗi",n instanceof Error?n.message:"Mã xác thực không đúng")}},L=async()=>{try{await d(r.getValues())}catch{a.error("Lỗi","Không thể gửi lại mã xác thực")}};return m?s.jsx(C,{title:"Xác thực 2 lớp",onSubmit:E,onResend:L}):s.jsx(T,{...r,children:s.jsxs("form",{onSubmit:r.handleSubmit(d),className:"space-y-8 w-full rounded-lg border bg-card text-card-foreground shadow-md p-8 bg-[#1b1e2b] border-color-[#495070]",children:[s.jsx(O,{children:"Đăng nhập"}),s.jsx(p,{control:r.control,name:"username",render:({field:t})=>s.jsxs(f,{children:[s.jsx(j,{children:"Username"}),s.jsx(b,{children:s.jsx(w,{placeholder:"easygun",...t})}),s.jsx(y,{})]})}),s.jsx(p,{control:r.control,name:"password",render:({field:t})=>s.jsxs(f,{children:[s.jsx(j,{children:"Mật khẩu"}),s.jsx(b,{children:s.jsx(w,{type:"password",...t})}),s.jsx(y,{})]})}),s.jsx(c,{type:"submit",className:"w-full",disabled:r.formState.isSubmitting,children:r.formState.isSubmitting?"Đang đăng nhập...":"Đăng Nhập"}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(c,{variant:"link",type:"button",children:s.jsx(g,{to:o.FORGOT_PASSWORD,children:"Quên mật khẩu?"})}),s.jsx(c,{variant:"link",type:"button",children:s.jsx(g,{to:o.SIGNUP,children:"Đăng ký"})})]})]})})},W=()=>s.jsx("div",{className:"flex md:min-w-[500px] md:max-w-[600px] px-[12px] mx-auto mt-[10vh]",children:s.jsx(U,{})});export{W as default};
