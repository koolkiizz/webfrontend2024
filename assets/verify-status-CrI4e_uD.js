import{c as m,f as C,r as f,b as D,d as L,j as e,B as y,h,k as F,e as q}from"./index-DOad2NjJ.js";import{a as d,e as u}from"./fetch-DTa09Loc.js";import{V as S}from"./verify-form-BScrRQ8F.js";/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=m("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=m("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=m("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function B(){const{executePost:s,isLoading:c,isError:a}=d(u.requestVerifyEmail());return{requestVerifyEmail:async()=>{try{return await s(void 0)}catch{throw new Error("Error")}},isLoading:c,isError:a}}function M(){const{executePost:s,isLoading:c,isError:a}=d(u.verifyEmail());return{verifyEmail:async t=>{try{return await s(t)}catch{throw new Error("Error")}},isLoading:c,isError:a}}function U(){const{executePost:s,isLoading:c,isError:a}=d(u.requestDuplicateVerify());return{requestDuplicateVerify:async()=>{try{return await s(void 0)}catch{throw new Error("Error")}},isLoading:c,isError:a}}function H(){const{executePost:s,isLoading:c,isError:a}=d(u.duplicateVerify());return{duplicateVerify:async t=>{try{return await s(t)}catch{throw new Error("Error")}},isLoading:c,isError:a}}function T(){const{executePost:s,isLoading:c,isError:a}=d(u.deActive2fa());return{deactive2FA:async()=>{const t=await s(void 0);if(t!=null&&t.success)return t==null?void 0:t.message;throw new Error(t==null?void 0:t.message)},isLoading:c,isError:a}}function X(){const{executePost:s,isLoading:c,isError:a}=d(u.validDeActive2fa());return{validDeActive2FA:async t=>{const r=await s(t);if(r!=null&&r.success)return r==null?void 0:r.message;throw new Error(r==null?void 0:r.message)},isLoading:c,isError:a}}const O=({verifyEmail:s,actived2fa:c,className:a})=>{const{toast:o}=C(),[t,r]=f.useState(!1),{deactive2FA:x,isLoading:v}=T(),{validDeActive2FA:w}=X(),{userInfo:b,updateUserInfo:j}=D(),p=f.useMemo(()=>[{title:"Xác thực email",description:"Xác nhận địa chỉ email của bạn",path:L.VERIFy_EMAIL}],[]),E=n=>n===0?s===1?"completed":s===0?"current":"pending":n===1?s===1&&c===1?"completed":s===1&&c===0?"current":"pending":"pending",V=s===1&&c===1,N=async()=>{try{const n=await x();n&&(r(!0),o({title:"Vui lòng xác thực",description:n||"Nhập mã xác thực được gửi đến email của bạn"}))}catch{o({variant:"destructive",title:"Lỗi",description:"Không thể hủy kích hoạt xác thực 2 lớp. Vui lòng thử lại sau."})}},k=async n=>{try{const l=await w({code:n});if(!l)throw new Error("Mã xác thực không đúng");o({title:"Thành công",description:l||"Đã hủy kích hoạt xác thực 2 lớp."}),r(!1),j({...b,"2fa":"0"})}catch{o({variant:"destructive",title:"Lỗi",description:"Không thể hủy kích hoạt xác thực 2 lớp. Vui lòng thử lại sau."})}},A=async()=>{try{if(!await x())throw new Error("Không thể gửi lại mã xác thực")}catch{o({variant:"destructive",title:"Lỗi",description:"Không thể hủy kích hoạt xác thực 2 lớp. Vui lòng thử lại sau."})}};return t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{title:"Xác nhận hủy kích hoạt 2FA",description:"Vui lòng nhập mã xác thực đã được gửi đến email của bạn",onSubmit:k,onResend:A,onExpired:()=>r(!1)}),e.jsx("div",{className:"flex justify-center",children:e.jsx(y,{variant:"outline",onClick:()=>r(!1),children:"Quay lại"})})]}):e.jsxs("div",{className:h("w-full p-6 rounded-lg border bg-card",a),children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Trạng thái xác thực tài khoản"}),e.jsx("div",{className:"space-y-8",children:p.map((n,l)=>{const i=E(l);return e.jsxs("div",{className:"relative",children:[l<p.length-1&&e.jsx("div",{className:h("absolute left-[30px] top-[48px] h-[calc(100%)] w-[2px]",{"bg-primary":i==="completed","bg-primary/50":i==="current","bg-muted":i==="pending"})}),e.jsxs("div",{className:h("flex items-start gap-4 p-4 rounded-lg transition-colors",{"bg-primary/5 border border-primary/20":i==="current","bg-muted/30":i==="completed"}),children:[e.jsx("div",{className:"relative flex h-[30px] w-[30px] shrink-0 items-center justify-center",children:i==="completed"?e.jsx(g,{className:"h-[30px] w-[30px] text-primary animate-in fade-in text-green-600"}):i==="current"?e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"h-[30px] w-[30px] text-primary animate-pulse"}),e.jsx("div",{className:"absolute -top-1 -right-1 h-2 w-2 rounded-full bg-primary bg-red-700 animate-ping"})]}):e.jsx(F,{className:"h-[30px] w-[30px] text-muted-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:h("flex items-center gap-2 text-base font-semibold",{"text-primary":i==="current","text-primary/80":i==="completed","text-muted-foreground":i==="pending"}),children:[e.jsx("span",{children:n.title}),i==="current"&&e.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded-full",children:"Bước hiện tại"})]}),e.jsx("div",{className:h("mt-1 text-sm",{"text-muted-foreground":i!=="current","text-foreground":i==="current"}),children:n.description}),i==="current"&&e.jsx(q,{to:n.path,className:"underline text-sm text-secondary-foreground",children:l===0?"Đi tới trang xác thực email ":"Đi tới trang thiết lập xác thực 2 lớp"}),i==="completed"&&e.jsx("p",{className:"mt-2 text-sm text-primary",children:"✓ Đã hoàn thành"}),i==="pending"&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Chờ xử lý"})]})]})]},l)})}),V&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"mt-6 rounded-lg border border-green-200 bg-green-50 p-4 text-center text-sm text-green-600",children:[e.jsx(g,{className:"inline-block h-5 w-5 mr-2"}),"Tài khoản của bạn đã được xác thực đầy đủ"]}),e.jsxs(y,{className:"w-fit",variant:"destructive",onClick:N,disabled:v,children:[e.jsx(R,{className:"inline-block h-5 w-5 mr-2"}),"Hủy kích hoạt email 2 lớp"]})]})]})};export{g as C,O as V,B as a,U as b,H as c,M as u};
