import{k as A,r as I,j as e,B as m}from"./index-DunV6tBQ.js";import{o as M,s as S,F as V,a as x,c as g,d as j,e as v,f as p,t as q}from"./form-QktVGgmh.js";import{u as k,I as J}from"./input-NnItHALo.js";import{C as B,a as F,b as w,c as f,d as N}from"./card-j9N-UeV_.js";import{S as L,a as E,b as P,c as T,d as D}from"./select-f6VOPMLS.js";import{u as R,e as X}from"./fetch-CV5YqZMl.js";import{u as K,a as O}from"./usePlayer-CGP5fvAk.js";import"./index-B1INIkwa.js";function W(){const{executePost:n,isLoading:d,isError:c}=R(X.requestClearBag());return{requestClearBag:async o=>{const r=await n(o);if(r!=null&&r.success)return r==null?void 0:r.success;throw new Error(r==null?void 0:r.message)},isLoading:d,isError:c}}function Y(){const{executePost:n,isLoading:d,isError:c}=R(X.validClearBag());return{validClearBag:async o=>{const r=await n(o);if(r!=null&&r.success)return r==null?void 0:r.success;throw new Error(r==null?void 0:r.message)},isLoading:d,isError:c}}const Z=M({serverId:S({required_error:"Vui lòng chọn server"}),playerId:S({required_error:"Vui lòng chọn nhân vật"})}),$=M({code:S().min(6,"Mã xác thực phải có ít nhất 6 ký tự")}),le=()=>{const{toast:n}=A(),[d,c]=I.useState("request"),[l,o]=I.useState(""),{serverData:r,isLoading:y}=K(!0),{playerData:h,isLoading:u}=O(l,!1),{requestClearBag:_,isLoading:C}=W(),{validClearBag:G,isLoading:b}=Y(),a=k({resolver:q(Z),defaultValues:{serverId:"",playerId:""}}),i=k({resolver:q($),defaultValues:{code:""},mode:"onChange"}),U=t=>{o(t),a.setValue("serverId",t),a.setValue("playerId","")},H=async t=>{try{await _({server_id:t.serverId,player_id:t.playerId})&&(c("verify"),n({title:"Thành công",description:"Vui lòng kiểm tra email để lấy mã xác thực"}),i.reset())}catch(s){n({variant:"destructive",title:"Lỗi",description:s instanceof Error?s.message:"Đã có lỗi xảy ra"})}},Q=async t=>{try{await G({code:t.code})&&(n({title:"Thành công",description:"Đã xóa mật khẩu túi đồ thành công"}),a.reset(),i.reset(),o(""),c("request"))}catch(s){n({variant:"destructive",title:"Lỗi",description:s instanceof Error?s.message:"Đã có lỗi xảy ra"})}};return d==="verify"?e.jsx("div",{className:"container mx-auto max-w-md py-8",children:e.jsxs(B,{children:[e.jsxs(F,{children:[e.jsx(w,{children:"Xác thực xóa mật khẩu túi đồ"}),e.jsx(f,{children:"Vui lòng nhập mã xác thực đã được gửi đến email của bạn"})]}),e.jsx(N,{children:e.jsx(V,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(Q),className:"space-y-6",id:"valid-clear-bag",children:[e.jsx(x,{control:i.control,name:"code",render:({field:t})=>e.jsxs(g,{children:[e.jsx(j,{children:"Mã xác thực"}),e.jsx(v,{children:e.jsx(J,{type:"text",placeholder:"Nhập mã xác thực",...t,value:i.getValues("code"),onChange:s=>{const z=s.target.value;i.setValue("code",z,{shouldValidate:!0,shouldDirty:!0})}})}),e.jsx(p,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>{c("request"),i.reset()},children:"Quay lại"}),e.jsx(m,{type:"submit",disabled:b||!i.formState.isValid,form:"valid-clear-bag",children:b?"Đang xác thực...":"Xác thực"})]})]})})})]})}):e.jsx("div",{className:"container mx-auto max-w-2xl py-8",children:e.jsxs(B,{children:[e.jsxs(F,{children:[e.jsx(w,{children:"Xóa mật khẩu túi đồ"}),e.jsx(f,{children:"Mật khẩu rương và câu hỏi bảo mật sẽ bị xóa khi thực hiện hành động này."}),e.jsx(f,{children:"Người chơi cần tải lại game khi tiến hành xóa mật khẩu."})]}),e.jsx(N,{children:e.jsx(V,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(H),className:"space-y-6",id:"clear-bag",children:[e.jsx(x,{control:a.control,name:"serverId",render:({field:t})=>e.jsxs(g,{children:[e.jsx(j,{children:"Server"}),e.jsxs(L,{disabled:y,onValueChange:U,value:t.value,children:[e.jsx(v,{children:e.jsx(E,{children:e.jsx(P,{placeholder:y?"Đang tải...":"Chọn server"})})}),e.jsx(T,{children:r==null?void 0:r.map(s=>e.jsx(D,{value:s.ServerID.toString(),children:s.ServerName},s.ServerID))})]}),e.jsx(p,{})]})}),e.jsx(x,{control:a.control,name:"playerId",render:({field:t})=>e.jsxs(g,{children:[e.jsx(j,{children:"Nhân vật"}),e.jsxs(L,{disabled:!l||u,onValueChange:t.onChange,value:t.value,children:[e.jsx(v,{children:e.jsx(E,{children:e.jsx(P,{placeholder:l?u?"Đang tải...":"Chọn nhân vật":"Vui lòng chọn server trước"})})}),e.jsx(T,{children:h==null?void 0:h.map(s=>e.jsx(D,{value:s.UserID.toString(),children:s.NickName},s.UserID))})]}),e.jsx(p,{})]})}),e.jsx(m,{type:"submit",className:"w-full",form:"clear-bag",disabled:a.formState.isSubmitting||u||!l||!a.formState.isValid||C,children:C?"Đang xử lý...":"Xóa mật khẩu rương"})]})})})]})})};export{le as default};
