import{k as A,i as D,r as a,l as L,j as t,B as c,m as O}from"./index-DunV6tBQ.js";import{o as N,s as g,t as k,F as S,a as d,c as l,d as h,e as m,f as u,g as X}from"./form-QktVGgmh.js";import{u as v,I as x}from"./input-NnItHALo.js";import{b as $,c as q}from"./useLogin-CccnekPl.js";import{A as B,a as G}from"./alert-Bn9zwCMx.js";import{C as H,a as K,b as P,c as U,d as W,e as Y}from"./card-j9N-UeV_.js";import"./fetch-CV5YqZMl.js";const z=N({currentPassword:g().min(1,"Yêu cầu nhập mật khẩu hiện tại."),newPassword:g().min(6,"Mật khẩu mới phải có ít nhất 6 ký tự."),confirmNewPassword:g().min(1,"Vui lòng nhập mật khẩu mới.")}).refine(s=>s.newPassword===s.confirmNewPassword,{message:"Mật khẩu không trùng khớp.",path:["confirmNewPassword"]}),J=N({verificationCode:g().min(6,{message:"Mã xác thực phải có ít nhất 6 ký tự."})}),y=120,Q=s=>{const r=Math.floor(s/60),f=s%60;return`${r}:${f.toString().padStart(2,"0")}`},Z=()=>{const s=v({resolver:k(z),defaultValues:{currentPassword:"",newPassword:"",confirmNewPassword:""}}),{toast:r}=A(),f=D(),[M,F]=a.useState(!1),[V,w]=a.useState(!1),[n,p]=a.useState(0),[j,b]=a.useState(!1),{changePassword:T}=$(),{validChangePassword:I}=q(),{logout:E}=L(),o=v({resolver:k(J),defaultValues:{verificationCode:""}});a.useEffect(()=>{let e;return n>0&&(e=setInterval(()=>{p(i=>i-1)},1e3)),()=>clearInterval(e)},[n]);async function R(e){try{const i=await T({current_password:e.currentPassword,new_password:e.newPassword,re_new_password:e.confirmNewPassword});if(i!=="success"){r({title:"Đổi mật khẩu không thành công! Vui lòng thử lại.",description:i});return}r({title:"Nhập mã xác thực để đổi mật khẩu thành công!"}),w(!0),p(y)}catch(i){console.log(i),r({title:"Đổi mật khẩu không thành công! Vui lòng thử lại."})}}const _=async()=>{if(!(n>0))try{b(!0),p(y),r({title:"Đã gửi lại mã",description:"Vui lòng kiểm tra email của bạn"})}catch{r({variant:"destructive",title:"Lỗi",description:"Không thể gửi lại mã xác thực"})}finally{b(!1)}},C=async e=>{try{if(n<=0){r({variant:"destructive",title:"Hết hạn",description:"Mã xác thực đã hết hạn. Vui lòng yêu cầu mã mới."});return}await I({code:e.verificationCode})?(w(!1),E(),F(!0)):r({variant:"destructive",title:"Thất bại",description:"Mã xác thực không đúng. Vui lòng thử lại."})}catch{r({variant:"destructive",title:"Lỗi",description:"Xác thực thất bại. Vui lòng thử lại."})}};return V?t.jsxs(H,{className:"w-full",children:[t.jsxs(K,{children:[t.jsx(P,{children:"Mã xác thực đổi mật khẩu"}),t.jsxs(U,{children:["Vui lòng điền code đã được gửi tới Email của bạn",n>0&&` (đếm ngược: ${Q(n)})`]})]}),t.jsx(W,{children:t.jsx(S,{...o,children:t.jsx("form",{onSubmit:o.handleSubmit(C),className:"space-y-4",children:t.jsx(d,{control:o.control,name:"verificationCode",render:({field:e})=>t.jsxs(l,{children:[t.jsx(h,{children:"Mã xác thực"}),t.jsx(m,{children:t.jsx(x,{placeholder:"Nhập mã xác thực",...e})}),t.jsx(u,{})]})})})})}),t.jsxs(Y,{className:"flex justify-between",children:[t.jsx(c,{variant:"outline",onClick:_,disabled:n>0||j,children:j?"Đang gửi...":"Gửi lại mã"}),t.jsx(c,{onClick:o.handleSubmit(C),disabled:o.formState.isSubmitting||n<=0,children:o.formState.isSubmitting?"Đang xác thực...":"Xác thực"})]})]}):M?t.jsxs(B,{children:[t.jsx(G,{children:"Mật khẩu đã được cập nhập. Vui lòng đăng nhập lại."}),t.jsx(c,{onClick:()=>{f(O.LOGIN)},children:"Tới trang đăng nhập"})]}):t.jsx(S,{...s,children:t.jsxs("form",{onSubmit:s.handleSubmit(R),className:"space-y-8 w-full rounded-lg border bg-card text-card-foreground shadow-md p-8 bg-[#1b1e2b] border-color-[#495070]",children:[t.jsx(P,{children:"Đổi mật khẩu"}),t.jsx(d,{control:s.control,name:"currentPassword",render:({field:e})=>t.jsxs(l,{children:[t.jsx(h,{children:"Mật khẩu hiện tại"}),t.jsx(m,{children:t.jsx(x,{type:"password",...e})}),t.jsx(u,{})]})}),t.jsx(d,{control:s.control,name:"newPassword",render:({field:e})=>t.jsxs(l,{children:[t.jsx(h,{children:"Mật khẩu mới"}),t.jsx(m,{children:t.jsx(x,{type:"password",...e})}),t.jsx(X,{children:"Mật khẩu của bạn phải dài hơn 6 ký tự."}),t.jsx(u,{})]})}),t.jsx(d,{control:s.control,name:"confirmNewPassword",render:({field:e})=>t.jsxs(l,{children:[t.jsx(h,{children:"Xác nhận mật khẩu mới"}),t.jsx(m,{children:t.jsx(x,{type:"password",...e})}),t.jsx(u,{})]})}),t.jsx(c,{type:"submit",disabled:s.formState.isSubmitting,children:s.formState.isSubmitting?"Đang xác thực...":"Xác Thực Mật Khẩu"})]})})},at=()=>(console.log("check token"),t.jsx("div",{className:"flex md:min-w-[500px] md:max-w-[600px] mx-auto mt-[10vh] rounded-lg p-6",children:t.jsx(Z,{})}));export{at as default};
