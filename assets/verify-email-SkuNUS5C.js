import{r as d,a as V,j as a,B as u}from"./index-CJ9OkdYx.js";import{V as j}from"./verify-form-BEFxapxz.js";import{u as E,a as v,V as o}from"./verify-status-DwbbGafn.js";import{b,c as N}from"./fetch-CZRub33F.js";import{u as w}from"./use-alert-D1fpYyrc.js";const k=({onRequestVerify:m,isLoading:r,verifyEmail:l,actived2fa:s})=>a.jsxs("div",{className:"space-y-6",children:[a.jsx(o,{verifyEmail:l,actived2fa:s}),a.jsx(b,{className:"w-full border-none shadow-none",children:a.jsx(N,{className:"pt-6",children:a.jsx(u,{className:"w-full",onClick:m,disabled:r,children:r?"Đang gửi mã xác thực...":"Yêu cầu mã xác thực email"})})})]}),L=()=>{const[m,r]=d.useState("check"),[l,s]=d.useState(!1),c=w(),{userInfo:i,updateUserInfo:h}=V(),{verifyEmail:x}=E(),{requestVerifyEmail:n}=v(),f=async()=>{try{s(!0);const e=await n();if(!(e!=null&&e.success)){c.error("Lỗi",e==null?void 0:e.message);return}c.success("Thành công",e==null?void 0:e.message),r("verify")}catch{c.error("Lỗi","Đã có lỗi xảy ra khi gửi mã xác thực")}finally{s(!1)}},y=async e=>{try{const t=await x({code:e});if(!(t!=null&&t.success)){c.error("Lỗi",t==null?void 0:t.message);return}c.success("Thành công",t==null?void 0:t.message),h({...i,VerifiedEmail:"1"}),r("check")}catch{c.error("Lỗi","Đã có lỗi xảy ra khi xác thực")}},g=async()=>{try{const e=await n();if(!(e!=null&&e.success)){c.error("Lỗi",e==null?void 0:e.message);return}c.success("Thông báo",e==null?void 0:e.message)}catch{c.error("Lỗi","Không thể gửi lại mã xác thực")}};return Number(i==null?void 0:i.VerifiedEmail)!==0?a.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] mx-auto mt-[10vh] rounded-lg px-[12px]",children:a.jsx(o,{verifyEmail:Number(i==null?void 0:i.VerifiedEmail),actived2fa:Number(i==null?void 0:i["2fa"])})}):a.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] mx-auto mt-[10vh] rounded-lg px-[12px]",children:m==="check"?a.jsx(k,{onRequestVerify:f,isLoading:l,verifyEmail:Number(i==null?void 0:i.VerifiedEmail),actived2fa:Number(i==null?void 0:i["2fa"])}):a.jsxs(a.Fragment,{children:[a.jsx(j,{title:"Xác nhận Email",description:"Vui lòng điền code đã được gửi tới Email của bạn",onSubmit:y,onResend:g,onExpired:()=>r("check")}),a.jsx("div",{className:"mt-4 flex justify-center",children:a.jsx(u,{variant:"outline",onClick:()=>r("check"),children:"Quay lại"})})]})})};export{L as default};
