import{r as d,a as p,j as t,B as x}from"./index-neaKrv17.js";import{V}from"./verify-form-Cq7kRNyl.js";import{b,c as C,V as N,C as S}from"./verify-status-P6-qms-M.js";import{A as w,b as f,a as k}from"./alert-TSzE5fCk.js";import{b as E,d as L,C as T,c as v,e as A}from"./utils-BD3ftINz.js";import{u as R}from"./use-alert-DM6nFZOr.js";import"./fetch-Cb1DhwTR.js";const D=({userInfo:c,isLoading:s,onStartVerification:r})=>t.jsxs(E,{className:"w-full border-none shadow-none",children:[t.jsx(L,{className:"gap-4",children:t.jsx(T,{children:"Thiết lập xác thực email 2 lớp"})}),t.jsx(v,{children:t.jsx(N,{verifyEmail:Number(c==null?void 0:c.VerifiedEmail),actived2fa:Number(c==null?void 0:c["2fa"])})}),!(Number(c==null?void 0:c.VerifiedEmail)===1&&Number(c==null?void 0:c["2fa"])===1)&&t.jsx(A,{className:"flex justify-end",children:t.jsx(x,{onClick:r,disabled:Number(c==null?void 0:c.VerifiedEmail)!==1||s,children:Number(c==null?void 0:c.VerifiedEmail)!==1?"Tiếp tục":s?"Đang gửi...":"Gửi mã xác thực"})})]}),F=()=>t.jsxs(w,{className:"mt-4",children:[t.jsx(S,{className:"h-4 w-4"}),t.jsx(f,{children:"Thành công"}),t.jsx(k,{children:"Email của bạn đã được xác thực 2 lớp."})]}),U=()=>{const[c,s]=d.useState("check"),[r,l]=d.useState(!1),e=R(),{userInfo:m,updateUserInfo:n}=p(),{requestDuplicateVerify:h,isLoading:o}=b(),{duplicateVerify:j}=C(),u=async()=>{try{const i=await h();if(!(i!=null&&i.success)){e.error("Lỗi",i==null?void 0:i.message);return}e.success("Thành công",i==null?void 0:i.message),s("verify")}catch{e.error("Lỗi","Đã có lỗi xảy ra khi gửi mã xác thực")}},g=async i=>{try{const a=await j({code:i});if(!(a!=null&&a.success)){e.error("Lỗi",a==null?void 0:a.message);return}n({...m,"2fa":"1"}),l(!0),e.success("Xác thực thành công",a==null?void 0:a.message),setTimeout(()=>{s("check"),l(!1)},2e3)}catch{e.error("Lỗi","Đã có lỗi xảy ra khi xác thực")}},y=async()=>{try{const i=await h();if(!(i!=null&&i.success)){e.error("Lỗi",i==null?void 0:i.message);return}e.success("Đã gửi lại mã",i==null?void 0:i.message)}catch{e.error("Lỗi","Không thể gửi lại mã xác thực")}};return t.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] px-[12px] mx-auto mt-[10vh]",children:c==="check"?t.jsx(D,{userInfo:m,isLoading:o,onStartVerification:u}):t.jsxs(t.Fragment,{children:[t.jsx(V,{title:"Xác thực 2 lớp",description:"Bước 2: Trạng thái kích hoạt xác thực email 2 lớp",onSubmit:g,onResend:y,onExpired:()=>s("check")}),r&&t.jsx(F,{}),t.jsx("div",{className:"mt-4 flex justify-center",children:t.jsx(x,{variant:"outline",onClick:()=>s("check"),children:"Quay lại"})})]})})};export{U as default};
