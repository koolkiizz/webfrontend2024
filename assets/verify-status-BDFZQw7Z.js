import{p as m,k as D,r as g,l as L,m as p,j as i,B as y,h,q as F,L as q}from"./index-BdpWGmwi.js";import{u,e as d}from"./fetch-D0pFaA7o.js";import{V as P}from"./verify-form-dIkUxfXt.js";/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=m("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=m("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=m("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function B(){const{executePost:c,isLoading:s,isError:n}=u(d.requestVerifyEmail());return{requestVerifyEmail:async()=>{const e=await c(void 0);if(e!=null&&e.success)return e==null?void 0:e.success;throw new Error(e==null?void 0:e.message)},isLoading:s,isError:n}}function M(){const{executePost:c,isLoading:s,isError:n}=u(d.verifyEmail());return{verifyEmail:async e=>{const t=await c(e);if(t!=null&&t.success)return t==null?void 0:t.success;throw new Error(t==null?void 0:t.message)},isLoading:s,isError:n}}function U(){const{executePost:c,isLoading:s,isError:n}=u(d.requestDuplicateVerify());return{requestDuplicateVerify:async()=>{const e=await c(void 0);if(e!=null&&e.success)return e==null?void 0:e.success;throw new Error(e==null?void 0:e.message)},isLoading:s,isError:n}}function _(){const{executePost:c,isLoading:s,isError:n}=u(d.duplicateVerify());return{duplicateVerify:async e=>{const t=await c(e);if(t!=null&&t.success)return t==null?void 0:t.success;throw new Error(t==null?void 0:t.message)},isLoading:s,isError:n}}function T(){const{executePost:c,isLoading:s,isError:n}=u(d.deActive2fa());return{deactive2FA:async()=>{const e=await c(void 0);if(e!=null&&e.success)return e==null?void 0:e.message;throw new Error(e==null?void 0:e.message)},isLoading:s,isError:n}}function I(){const{executePost:c,isLoading:s,isError:n}=u(d.validDeActive2fa());return{validDeActive2FA:async e=>{const t=await c(e);if(t!=null&&t.success)return t==null?void 0:t.message;throw new Error(t==null?void 0:t.message)},isLoading:s,isError:n}}const H=({verifyEmail:c,actived2fa:s,className:n})=>{const{toast:l}=D(),[e,t]=g.useState(!1),{deactive2FA:x,isLoading:w}=T(),{validDeActive2FA:b}=I(),{userInfo:j,updateUserInfo:V}=L(),f=g.useMemo(()=>[{title:"Xác thực email",description:"Xác nhận địa chỉ email của bạn",path:p.VERIFy_EMAIL},{title:"Xác thực 2 lớp",description:"Thiết lập bảo mật 2 lớp cho tài khoản",path:p.DUPLICATE_VERIFY}],[]),N=a=>a===0?c===1?"completed":c===0?"current":"pending":a===1?c===1&&s===1?"completed":c===1&&s===0?"current":"pending":"pending",k=c===1&&s===1,E=async()=>{try{const a=await x();a&&(t(!0),l({title:"Vui lòng xác thực",description:a||"Nhập mã xác thực được gửi đến email của bạn"}))}catch{l({variant:"destructive",title:"Lỗi",description:"Không thể hủy kích hoạt xác thực 2 lớp. Vui lòng thử lại sau."})}},A=async a=>{try{const o=await b({code:a});if(!o)throw new Error("Mã xác thực không đúng");l({title:"Thành công",description:o||"Đã hủy kích hoạt xác thực 2 lớp."}),t(!1),V({...j,"2fa":"0"})}catch{l({variant:"destructive",title:"Lỗi",description:"Không thể hủy kích hoạt xác thực 2 lớp. Vui lòng thử lại sau."})}},C=async()=>{try{if(!await x())throw new Error("Không thể gửi lại mã xác thực")}catch{l({variant:"destructive",title:"Lỗi",description:"Không thể hủy kích hoạt xác thực 2 lớp. Vui lòng thử lại sau."})}};return e?i.jsxs("div",{className:"space-y-4",children:[i.jsx(P,{title:"Xác nhận hủy kích hoạt 2FA",description:"Vui lòng nhập mã xác thực đã được gửi đến email của bạn",onSubmit:A,onResend:C,onExpired:()=>t(!1)}),i.jsx("div",{className:"flex justify-center",children:i.jsx(y,{variant:"outline",onClick:()=>t(!1),children:"Quay lại"})})]}):i.jsxs("div",{className:h("w-full p-6 rounded-lg border bg-card",n),children:[i.jsx("h3",{className:"text-lg font-semibold mb-6",children:"Trạng thái xác thực tài khoản"}),i.jsx("div",{className:"space-y-8",children:f.map((a,o)=>{const r=N(o);return i.jsxs("div",{className:"relative",children:[o<f.length-1&&i.jsx("div",{className:h("absolute left-[30px] top-[48px] h-[calc(100%)] w-[2px]",{"bg-primary":r==="completed","bg-primary/50":r==="current","bg-muted":r==="pending"})}),i.jsxs("div",{className:h("flex items-start gap-4 p-4 rounded-lg transition-colors",{"bg-primary/5 border border-primary/20":r==="current","bg-muted/30":r==="completed"}),children:[i.jsx("div",{className:"relative flex h-[30px] w-[30px] shrink-0 items-center justify-center",children:r==="completed"?i.jsx(v,{className:"h-[30px] w-[30px] text-primary animate-in fade-in text-green-600"}):r==="current"?i.jsxs("div",{className:"relative",children:[i.jsx(R,{className:"h-[30px] w-[30px] text-primary animate-pulse"}),i.jsx("div",{className:"absolute -top-1 -right-1 h-2 w-2 rounded-full bg-primary bg-red-700 animate-ping"})]}):i.jsx(F,{className:"h-[30px] w-[30px] text-muted-foreground"})}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:h("flex items-center gap-2 text-base font-semibold",{"text-primary":r==="current","text-primary/80":r==="completed","text-muted-foreground":r==="pending"}),children:[i.jsx("span",{children:a.title}),r==="current"&&i.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded-full",children:"Bước hiện tại"})]}),i.jsx("div",{className:h("mt-1 text-sm",{"text-muted-foreground":r!=="current","text-foreground":r==="current"}),children:a.description}),r==="current"&&i.jsx(q,{to:a.path,className:"underline text-sm text-secondary-foreground",children:o===0?"Đi tới trang xác thực email ":"Đi tới trang thiết lập xác thực 2 lớp"}),r==="completed"&&i.jsx("p",{className:"mt-2 text-sm text-primary",children:"✓ Đã hoàn thành"}),r==="pending"&&i.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Chờ xử lý"})]})]})]},o)})}),k&&i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsxs("div",{className:"mt-6 rounded-lg border border-green-200 bg-green-50 p-4 text-center text-sm text-green-600",children:[i.jsx(v,{className:"inline-block h-5 w-5 mr-2"}),"Tài khoản của bạn đã được xác thực đầy đủ"]}),i.jsxs(y,{className:"w-fit",variant:"destructive",onClick:E,disabled:w,children:[i.jsx(S,{className:"inline-block h-5 w-5 mr-2"}),"Hủy kích hoạt email 2 lớp"]})]})]})};export{v as C,H as V,B as a,U as b,_ as c,M as u};
