import{r as x,u as F,a as M,j as r,B as g,b as N}from"./index-CJ9OkdYx.js";import{o as T,s as i,u as V,a as L,t as A,F as E,b as c,c as d,d as m,e as h,I as u,f as l,g as I}from"./use-alert-D1fpYyrc.js";import{A as v,a as R}from"./alert-CY6BRpoq.js";import{C as _}from"./fetch-CZRub33F.js";import{d as B,e as D}from"./useLogin-CPGxi838.js";import{V as K}from"./verify-form-BEFxapxz.js";const O=T({currentPassword:i().min(1,"Yêu cầu nhập mật khẩu hiện tại."),newPassword:i().min(6,"Mật khẩu mới phải có ít nhất 6 ký tự."),confirmNewPassword:i().min(1,"Vui lòng nhập mật khẩu mới.")}).refine(o=>o.newPassword===o.confirmNewPassword,{message:"Mật khẩu không trùng khớp.",path:["confirmNewPassword"]}),X=()=>{const[o,p]=x.useState(!1),[f,a]=x.useState(!1),n=V(),j=F(),{changePassword:b}=B(),{validChangePassword:P}=D(),{logout:w}=M(),t=L({resolver:A(O),defaultValues:{currentPassword:"",newPassword:"",confirmNewPassword:""}});async function k(e){try{const s=await b({current_password:e.currentPassword,new_password:e.newPassword,re_new_password:e.confirmNewPassword});if(!(s!=null&&s.success)){n.error("Lỗi",s==null?void 0:s.message);return}if((s==null?void 0:s.success)===2){n.success("Thành công",s==null?void 0:s.message),a(!0);return}n.success("Thành công",s==null?void 0:s.message),w()}catch(s){n.error("Lỗi",s==null?void 0:s.message)}}const S=async e=>{try{const s=await P({code:e});if(!(s!=null&&s.success)){n.error("Lỗi",s==null?void 0:s.message);return}n.success("Thành công",s==null?void 0:s.message),a(!1),w(),p(!0)}catch{n.error("Lỗi","Mã xác thực không đúng")}},C=async()=>{try{n.success("Đã gửi lại mã","Vui lòng kiểm tra email của bạn")}catch{n.error("Lỗi","Không thể gửi lại mã xác thực")}},y=()=>{a(!1)};return f?r.jsx(K,{title:"Mã xác thực đổi mật khẩu",onSubmit:S,onResend:C,onExpired:y}):o?r.jsxs(v,{children:[r.jsx(R,{children:"Mật khẩu đã được cập nhập. Vui lòng đăng nhập lại."}),r.jsx(g,{onClick:()=>{j(N.LOGIN)},children:"Tới trang đăng nhập"})]}):r.jsx(E,{...t,children:r.jsxs("form",{onSubmit:t.handleSubmit(k),className:"space-y-8 w-full rounded-lg border bg-card text-card-foreground shadow-md p-8 bg-[#1b1e2b] border-color-[#495070]",children:[r.jsx(_,{children:"Đổi mật khẩu"}),r.jsx(c,{control:t.control,name:"currentPassword",render:({field:e})=>r.jsxs(d,{children:[r.jsx(m,{children:"Mật khẩu hiện tại"}),r.jsx(h,{children:r.jsx(u,{type:"password",...e})}),r.jsx(l,{})]})}),r.jsx(c,{control:t.control,name:"newPassword",render:({field:e})=>r.jsxs(d,{children:[r.jsx(m,{children:"Mật khẩu mới"}),r.jsx(h,{children:r.jsx(u,{type:"password",...e})}),r.jsx(I,{children:"Mật khẩu của bạn phải dài hơn 6 ký tự."}),r.jsx(l,{})]})}),r.jsx(c,{control:t.control,name:"confirmNewPassword",render:({field:e})=>r.jsxs(d,{children:[r.jsx(m,{children:"Xác nhận mật khẩu mới"}),r.jsx(h,{children:r.jsx(u,{type:"password",...e})}),r.jsx(l,{})]})}),r.jsx(g,{type:"submit",disabled:t.formState.isSubmitting,children:t.formState.isSubmitting?"Đang xác thực...":"Xác Thực Mật Khẩu"})]})})},J=()=>r.jsx("div",{className:"flex md:min-w-[500px] md:max-w-[600px] mx-auto mt-[10vh] rounded-lg p-6",children:r.jsx(X,{})});export{J as default};
