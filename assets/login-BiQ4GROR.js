import{a as X,r as c,u as K,b as q,j as e,P as O,d as F,e as z,f as Q,h as I,C as W,i as $,k as J,l as Y,m as b,B as y,L as R}from"./index-D_cEefWi.js";import{o as Z,s as M,b as ee,u as te,t as se,F as ne,a as C,c as w,d as E,e as S,I as L,f as A,g as re}from"./input-BE6YdM2V.js";import{C as oe}from"./fetch-eecNlH2-.js";import{u as ae}from"./index-DeeQJNgo.js";import{u as ie,a as ce}from"./useLogin-DNZHqiHq.js";import{V as de}from"./verify-form-Bbqnhd8d.js";var N="Checkbox",[le,Ce]=X(N),[ue,me]=le(N),T=c.forwardRef((s,d)=>{const{__scopeCheckbox:t,name:l,checked:m,defaultChecked:a,required:p,disabled:o,value:u="on",onCheckedChange:n,...h}=s,[r,k]=c.useState(null),H=K(d,i=>k(i)),j=c.useRef(!1),P=r?!!r.closest("form"):!0,[x=!1,v]=q({prop:m,defaultProp:a,onChange:n}),U=c.useRef(x);return c.useEffect(()=>{const i=r==null?void 0:r.form;if(i){const g=()=>v(U.current);return i.addEventListener("reset",g),()=>i.removeEventListener("reset",g)}},[r,v]),e.jsxs(ue,{scope:t,state:x,disabled:o,children:[e.jsx(O.button,{type:"button",role:"checkbox","aria-checked":f(x)?"mixed":x,"aria-required":p,"data-state":D(x),"data-disabled":o?"":void 0,disabled:o,value:u,...h,ref:H,onKeyDown:F(s.onKeyDown,i=>{i.key==="Enter"&&i.preventDefault()}),onClick:F(s.onClick,i=>{v(g=>f(g)?!0:!g),P&&(j.current=i.isPropagationStopped(),j.current||i.stopPropagation())})}),P&&e.jsx(he,{control:r,bubbles:!j.current,name:l,value:u,checked:x,required:p,disabled:o,style:{transform:"translateX(-100%)"}})]})});T.displayName=N;var V="CheckboxIndicator",_=c.forwardRef((s,d)=>{const{__scopeCheckbox:t,forceMount:l,...m}=s,a=me(V,t);return e.jsx(z,{present:l||f(a.state)||a.state===!0,children:e.jsx(O.span,{"data-state":D(a.state),"data-disabled":a.disabled?"":void 0,...m,ref:d,style:{pointerEvents:"none",...s.style}})})});_.displayName=V;var he=s=>{const{control:d,checked:t,bubbles:l=!0,...m}=s,a=c.useRef(null),p=ae(t),o=Q(d);return c.useEffect(()=>{const u=a.current,n=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(n,"checked").set;if(p!==t&&r){const k=new Event("click",{bubbles:l});u.indeterminate=f(t),r.call(u,f(t)?!1:t),u.dispatchEvent(k)}},[p,t,l]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:f(t)?!1:t,...m,tabIndex:-1,ref:a,style:{...s.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function f(s){return s==="indeterminate"}function D(s){return f(s)?"indeterminate":s?"checked":"unchecked"}var B=T,pe=_;const G=c.forwardRef(({className:s,...d},t)=>e.jsx(B,{ref:t,className:I("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...d,children:e.jsx(pe,{className:I("flex items-center justify-center text-current"),children:e.jsx(W,{className:"h-4 w-4"})})}));G.displayName=B.displayName;const fe=Z({username:M().min(2,{message:"Username phải có ít nhất 2 ký tự."}),password:M().min(6,{message:"Password phải có ít nhất 6 ký tự."}),rememberMe:ee().default(!1)}),xe=()=>{const[s,d]=c.useState(!1),t=$(),{toast:l}=J(),{login:m}=Y(),{login:a}=ie(),{validLogin:p}=ce(),o=te({resolver:se(fe),defaultValues:{username:"",password:"",rememberMe:!1}});c.useEffect(()=>{localStorage.getItem("token")&&t(b.HOMEPAGE)},[t]);async function u(n){var h;try{const r=await a(n.username,n.password);if(!r||!r&&!s){d(!0),l({title:"Xác thực 2 lớp",description:"Vui lòng kiểm tra email của bạn để lấy mã xác thực"});return}m(r),Number((h=r.userInfo)==null?void 0:h.VerifiedEmail)===0?t(b.VERIFy_EMAIL):t(b.HOMEPAGE)}catch{l({variant:"destructive",title:"Lỗi",description:"Đăng nhập thất bại. Vui lòng kiểm tra lại thông tin."})}}return s?e.jsx(de,{title:"Xác thực 2 lớp",onSubmit:async n=>{const h=await p({code:n});if(h)m(h),t(b.HOMEPAGE);else throw new Error("Mã xác thực không đúng")},onResend:async()=>{await u(o.getValues())}}):e.jsx(ne,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(u),className:"space-y-8 w-full rounded-lg border bg-card text-card-foreground shadow-md p-8 bg-[#1b1e2b] border-color-[#495070]",children:[e.jsx(oe,{children:"Đăng nhập"}),e.jsx(C,{control:o.control,name:"username",render:({field:n})=>e.jsxs(w,{children:[e.jsx(E,{children:"Username"}),e.jsx(S,{children:e.jsx(L,{placeholder:"easygun",...n})}),e.jsx(A,{})]})}),e.jsx(C,{control:o.control,name:"password",render:({field:n})=>e.jsxs(w,{children:[e.jsx(E,{children:"Mật khẩu"}),e.jsx(S,{children:e.jsx(L,{type:"password",...n})}),e.jsx(A,{})]})}),e.jsx(C,{control:o.control,name:"rememberMe",render:({field:n})=>e.jsxs(w,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(S,{children:e.jsx(G,{checked:n.value,onCheckedChange:n.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(E,{children:"Nhớ tài khoản"}),e.jsx(re,{children:"Giữ trạng thái đăng nhập của tài khoản tại thiết bị này."})]})]})}),e.jsx(y,{type:"submit",className:"w-full",disabled:o.formState.isSubmitting,children:o.formState.isSubmitting?"Đang đăng nhập...":"Đăng Nhập"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{variant:"link",type:"button",children:e.jsx(R,{to:b.FORGOT_PASSWORD,children:"Quên mật khẩu?"})}),e.jsx(y,{variant:"link",type:"button",children:e.jsx(R,{to:b.SIGNUP,children:"Đăng ký"})})]})]})})},we=()=>e.jsx("div",{className:"flex md:min-w-[500px] md:max-w-[600px] px-[12px] mx-auto mt-[10vh]",children:e.jsx(xe,{})});export{we as default};
