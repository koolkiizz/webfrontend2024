import{r as n,k,l as T,j as e,B as l}from"./index-Dvnajl35.js";import{u as q,L as A,I as M}from"./input-FzAILHxf.js";import{u as R,a as F,V as v,C as L}from"./useVerify-uxRmPGRa.js";import{A as X,b as D,a as $}from"./alert-BD--gHYU.js";import{C as g,d as j,a as B,b as O,c as U,e as G}from"./card-CT9DdWnJ.js";import"./fetch-DadqnHmJ.js";const H=120,J=()=>{const[b,o]=n.useState(!1),[s,d]=n.useState(0),[c,m]=n.useState(!1),{toast:a}=k(),{register:C,handleSubmit:h,formState:{errors:x,isSubmitting:u}}=q(),{verifyEmail:y}=R(),{requestVerifyEmail:w}=F(),{userInfo:i,updateUserInfo:E}=T(),N=t=>{const r=Math.floor(t/60),S=t%60;return`${r}:${S.toString().padStart(2,"0")}`};n.useEffect(()=>{let t;return s>0&&(t=setInterval(()=>{d(r=>r-1)},1e3)),()=>clearInterval(t)},[s]);const f=async()=>{try{m(!0),await w()?(a({title:"Mã xác thực đã được gửi",description:"Vui lòng kiểm tra email của bạn"}),o(!0),d(H)):a({variant:"destructive",title:"Lỗi",description:"Không thể gửi mã xác thực"})}catch{a({variant:"destructive",title:"Lỗi",description:"Đã có lỗi xảy ra khi gửi mã xác thực"})}finally{m(!1)}},p=async t=>{try{if(!await y({code:t.verificationCode})){a({variant:"destructive",title:"Xác thực thất bại",description:"Mã xác thực không đúng"});return}a({title:"Xác thực thành công",description:"Email của bạn đã được xác thực"}),E({...i,VerifiedEmail:"1"}),o(!1)}catch{a({variant:"destructive",title:"Lỗi",description:"Đã có lỗi xảy ra khi xác thực"})}},V=async()=>{s>0||await f()};return Number(i==null?void 0:i.VerifiedEmail)!==0?e.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] mx-auto mt-[10vh] rounded-lg px-[12px]",children:e.jsx(v,{verifyEmail:Number(i==null?void 0:i.VerifiedEmail),actived2fa:Number(i==null?void 0:i["2fa"])})}):e.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] mx-auto mt-[10vh] rounded-lg px-[12px]",children:b?e.jsxs(g,{className:"w-full border-none shadow-none",children:[e.jsxs(B,{children:[e.jsx(O,{children:"Xác nhận Email"}),e.jsxs(U,{children:["Vui lòng điền code đã được gửi tới Email của bạn",s>0&&` (đếm ngược: ${N(s)})`]})]}),e.jsx(j,{children:e.jsx("form",{onSubmit:h(p),children:e.jsx("div",{className:"grid w-full items-center gap-8",children:e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx(A,{htmlFor:"verificationCode",children:"Mã xác thực"}),e.jsx(M,{id:"verificationCode",placeholder:"Điền mã xác thực",...C("verificationCode",{required:"Mã xác thực là bắt buộc"})}),x.verificationCode&&e.jsxs(X,{variant:"destructive",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(D,{children:"Thất bại"}),e.jsx($,{children:x.verificationCode.message})]})]})})})}),e.jsxs(G,{className:"flex justify-between",children:[e.jsx(l,{variant:"outline",onClick:V,disabled:s>0||c,children:c?"Đang gửi...":"Gửi lại mã xác thực"}),e.jsx(l,{onClick:h(p),disabled:u,children:u?"Đang xác thực...":"Xác thực"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{verifyEmail:Number(i==null?void 0:i.VerifiedEmail),actived2fa:Number(i==null?void 0:i["2fa"])}),e.jsx(g,{className:"w-full border-none shadow-none",children:e.jsx(j,{className:"pt-6",children:e.jsx(l,{className:"w-full",onClick:f,disabled:c,children:c?"Đang gửi mã xác thực...":"Yêu cầu mã xác thực email"})})})]})})};export{J as default};
