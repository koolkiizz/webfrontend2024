import{p as K,k as J,r as j,j as e,B as S}from"./index-DUiZQG6g.js";import{o as Q,s as p,u as R,F as W,a as v,c as f,d as a,e as y,f as g,I as Y,t as Z}from"./input-CAS36Rw2.js";import{V as D}from"./verify-form-CC2gme-z.js";import{a as E,c as $,C as q,f as G,b as U}from"./fetch-D-GyEK-U.js";import{S as V,a as k,b as F,c as M,d as _}from"./select-DLngc7GR.js";import{a as ee,b as re}from"./useCoin-IwBCUBfA.js";import{u as se,a as ne,b as te,c as ie}from"./usePlayer-Bh69RbNt.js";import"./index-DjqpBOgA.js";/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=K("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),b=600,N=1e8,oe=Q({serverId:p({required_error:"Vui lòng chọn server"}),playerId:p({required_error:"Vui lòng chọn nhân vật"}),amount:p().refine(c=>{const n=Number(c);return!isNaN(n)&&n>=b&&n<=N},{message:`Số coin phải từ ${b.toLocaleString()} đến ${N.toLocaleString()}`})}),ae=({coinData:c,loadingCoin:n,onRefresh:l})=>e.jsxs(E,{className:"mb-6",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsx(q,{className:"text-xl font-bold",children:"Số coin hiện tại"}),e.jsx(G,{children:"Số coin bạn có thể chuyển"})]}),e.jsx(S,{variant:"outline",size:"icon",onClick:l,disabled:n,children:e.jsx(ce,{className:`h-4 w-4 ${n?"animate-spin":""}`})})]}),e.jsx(U,{children:e.jsx("div",{className:"text-2xl font-bold",children:n?e.jsx("span",{className:"text-muted-foreground",children:"Đang tải..."}):e.jsxs("span",{children:[(c==null?void 0:c.coin.toLocaleString())||0," coin"]})})})]}),fe=()=>{const{toast:c}=J(),[n,l]=j.useState(""),[X,C]=j.useState("transfer"),[o,I]=j.useState(null),{serverData:h,isLoading:w}=se(!0),{playerData:u,isLoading:m}=ne(n,!1),{transferRateData:t}=te(n,!1),{coinData:d,isLoading:A,refetch:L}=ie(!0),{transferCoin:T}=ee(),{validTransfer:B}=re(),i=R({resolver:Z(oe),defaultValues:{serverId:"",playerId:"",amount:""}}),H=r=>{l(r),i.setValue("serverId",r),i.setValue("playerId","")},P=async r=>{try{const s=Number(r.amount);if(s>((d==null?void 0:d.coin)||0)){c({variant:"destructive",title:"Lỗi",description:"Số coin chuyển không được lớn hơn số coin hiện có"});return}if(!await T({server_id:r.serverId,player_id:r.playerId,coin:s}))throw new Error("Đã có lỗi xảy ra khi chuyển coin");I(r),C("verify")}catch(s){c({variant:"destructive",title:"Lỗi",description:s instanceof Error?s.message:"Đã có lỗi xảy ra khi chuyển coin"})}},O=async r=>{if(await B({code:r}))c({title:"Thành công",description:"Chuyển coin thành công"}),x(),L();else throw new Error("Mã xác thực không đúng")},z=async()=>{if(o)try{await T({server_id:o.serverId,player_id:o.playerId,coin:Number(o.amount)})}catch{throw new Error("Không thể gửi lại mã xác thực")}},x=()=>{i.reset(),l(""),I(null),C("transfer")};return X==="verify"?e.jsxs("div",{className:"container mx-auto max-w-md py-8",children:[e.jsx(D,{title:"Xác thực chuyển coin",description:`Xác nhận chuyển ${Number(o==null?void 0:o.amount).toLocaleString()} coin`,onSubmit:O,onResend:z,onExpired:x}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(S,{variant:"outline",onClick:x,children:"Hủy"})})]}):e.jsxs("div",{className:"container mx-auto max-w-2xl py-8",children:[e.jsx(ae,{coinData:d,loadingCoin:A,onRefresh:L}),e.jsxs(E,{children:[e.jsxs($,{children:[e.jsx(q,{children:"Chuyển coin"}),e.jsx(G,{children:"Chọn server và nhân vật để chuyển coin"})]}),e.jsx(U,{children:e.jsx(W,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(P),className:"space-y-6",children:[e.jsx(v,{control:i.control,name:"serverId",render:({field:r})=>e.jsxs(f,{children:[e.jsx(a,{children:"Server"}),e.jsxs(V,{disabled:w,onValueChange:H,value:r.value,children:[e.jsx(y,{children:e.jsx(k,{children:e.jsx(F,{placeholder:w?"Đang tải...":"Chọn server"})})}),e.jsx(M,{children:h==null?void 0:h.map(s=>e.jsx(_,{value:s.ServerID.toString(),children:s.ServerName},s.ServerID))})]}),(t==null?void 0:t.rate)&&e.jsxs(a,{className:"italic text-s text-gray-700 font-medium",children:["Tỉ lệ quy đổi 1.000 = ",Number(t==null?void 0:t.rate)*1e3," xu"]}),e.jsx(g,{})]})}),e.jsx(v,{control:i.control,name:"playerId",render:({field:r})=>e.jsxs(f,{children:[e.jsx(a,{children:"Nhân vật"}),e.jsxs(V,{disabled:!n||m,onValueChange:r.onChange,value:r.value,children:[e.jsx(y,{children:e.jsx(k,{children:e.jsx(F,{placeholder:n?m?"Đang tải...":"Chọn nhân vật":"Vui lòng chọn server trước"})})}),e.jsx(M,{children:u==null?void 0:u.map(s=>e.jsx(_,{value:s.UserID.toString(),children:s.NickName},s.UserID))})]}),e.jsx(g,{})]})}),e.jsx(v,{control:i.control,name:"amount",render:({field:r})=>e.jsxs(f,{children:[e.jsxs(a,{children:["Số coin chuyển"," ",r.value&&Number(t==null?void 0:t.rate)&&`( ${Number(r.value)*Number(t==null?void 0:t.rate)}  xu)`]}),e.jsx(y,{children:e.jsx(Y,{type:"number",placeholder:`Nhập số coin (${b.toLocaleString()} - ${N.toLocaleString()})`,...r})}),e.jsx(a,{className:"italic text-s text-gray-700 font-medium",children:"**X2 khi nạp lần đầu (tối đa 1,500,000 VND)**"}),e.jsx(a,{className:"italic text-s text-gray-700 font-medium block",children:"**Tối thiếu 600 coin**"}),e.jsx(g,{})]})}),e.jsx(S,{type:"submit",className:"w-full",disabled:i.formState.isSubmitting||m||!n||!i.formState.isValid,children:i.formState.isSubmitting?"Đang xử lý...":"Chuyển coin"})]})})})]})]})};export{fe as default};
