import{o as oe,r as h,j as e,O as B,h as u,y as R,z as ce,X as le,T as D,A as J,E as de,F as he,k as me,B as x}from"./index-Dvnajl35.js";import{o as K,s as v,F,a as p,c as g,d,e as j,f,t as M}from"./form-BOk3jqF5.js";import{u as z,I as O}from"./input-FzAILHxf.js";import{C as _,a as $,b as H,c as P,d as X}from"./card-CT9DdWnJ.js";import{S as q,a as A,b as G,c as U,d as E}from"./select-rDVC6wee.js";import{a as ue,b as xe}from"./useCoin-d_ThFu8e.js";import{u as pe,a as ge,b as je,c as fe}from"./usePlayer-Gr7SWoTv.js";import"./index-CKSDTYnq.js";import"./fetch-DadqnHmJ.js";/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=oe("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ye=de,Ne=he,Q=h.forwardRef(({className:s,...t},o)=>e.jsx(B,{ref:o,className:u("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));Q.displayName=B.displayName;const W=h.forwardRef(({className:s,children:t,...o},y)=>e.jsxs(Ne,{children:[e.jsx(Q,{}),e.jsxs(R,{ref:y,className:u("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...o,children:[t,e.jsxs(ce,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));W.displayName=R.displayName;const Y=({className:s,...t})=>e.jsx("div",{className:u("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});Y.displayName="DialogHeader";const Z=h.forwardRef(({className:s,...t},o)=>e.jsx(D,{ref:o,className:u("text-lg font-semibold leading-none tracking-tight",s),...t}));Z.displayName=D.displayName;const ee=h.forwardRef(({className:s,...t},o)=>e.jsx(J,{ref:o,className:u("text-sm text-muted-foreground",s),...t}));ee.displayName=J.displayName;const L=600,w=1e8,Se=K({serverId:v({required_error:"Vui lòng chọn server"}),playerId:v({required_error:"Vui lòng chọn nhân vật"}),amount:v().refine(s=>{const t=Number(s);return!isNaN(t)&&t>=L&&t<=w},{message:`Số coin phải từ ${L.toLocaleString()} đến ${w.toLocaleString()}`})}),be=K({code:v().min(6,"Mã xác thực phải có ít nhất 6 ký tự")}),Oe=()=>{var V;const{toast:s}=me(),[t,o]=h.useState(""),[y,N]=h.useState(!1),[c,se]=h.useState(null),{serverData:S,isLoading:T}=pe(!0),{playerData:b,isLoading:C}=ge(t,!1),{transferRateData:i}=je(t,!1),{coinData:m,isLoading:I,refetch:k}=fe(!0),{transferCoin:te}=ue(),{validTransfer:ne}=xe(),r=z({resolver:M(Se),defaultValues:{serverId:"",playerId:"",amount:""}}),l=z({resolver:M(be),defaultValues:{code:""}}),ae=n=>{o(n),r.setValue("serverId",n),r.setValue("playerId","")},ie=async n=>{try{const a=Number(n.amount);if(a>((m==null?void 0:m.coin)||0)){s({variant:"destructive",title:"Lỗi",description:"Số coin chuyển không được lớn hơn số coin hiện có"});return}if(!await te({server_id:n.serverId,player_id:n.playerId,coin:a})){s({variant:"destructive",title:"Lỗi",description:"Đã có lỗi xảy ra khi chuyển coin"});return}s({title:"Chúc mừng",description:"Chuyển xu thành công, nhận xu trong game nhé!"}),r.reset(),k()}catch{s({variant:"destructive",title:"Lỗi",description:"Đã có lỗi xảy ra khi chuyển coin"})}},re=async n=>{try{if(!c)return;await ne({code:n.code})?(s({title:"Thành công",description:"Chuyển coin thành công"}),r.reset(),l.reset(),o(""),N(!1),se(null),k()):s({variant:"destructive",title:"Lỗi",description:"Mã xác thực không đúng"})}catch{s({variant:"destructive",title:"Lỗi",description:"Đã có lỗi xảy ra khi xác thực"})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mx-auto max-w-2xl py-8",children:[e.jsxs(_,{className:"mb-6",children:[e.jsxs($,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsx(H,{className:"text-xl font-bold",children:"Số coin hiện tại"}),e.jsx(P,{children:"Số coin bạn có thể chuyển"})]}),e.jsx(x,{variant:"outline",size:"icon",onClick:()=>k(),disabled:I,children:e.jsx(ve,{className:`h-4 w-4 ${I?"animate-spin":""}`})})]}),e.jsx(X,{children:e.jsx("div",{className:"text-2xl font-bold",children:I?e.jsx("span",{className:"text-muted-foreground",children:"Đang tải..."}):e.jsxs("span",{children:[(m==null?void 0:m.coin.toLocaleString())||0," coin"]})})})]}),e.jsxs(_,{children:[e.jsxs($,{children:[e.jsx(H,{children:"Chuyển coin"}),e.jsx(P,{children:"Chọn server và nhân vật để chuyển coin"})]}),e.jsx(X,{children:e.jsx(F,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(ie),className:"space-y-6",children:[e.jsx(p,{control:r.control,name:"serverId",render:({field:n})=>e.jsxs(g,{children:[e.jsx(d,{children:"Server"}),e.jsxs(q,{disabled:T,onValueChange:ae,value:n.value,children:[e.jsx(j,{children:e.jsx(A,{children:e.jsx(G,{placeholder:T?"Đang tải...":"Chọn server"})})}),e.jsx(U,{children:S==null?void 0:S.map(a=>e.jsx(E,{value:a.ServerID.toString(),children:a.ServerName},a.ServerID))})]}),(i==null?void 0:i.rate)&&e.jsxs(d,{className:"italic text-s text-gray-700 font-medium",children:["Tỉ lệ quy đổi 1.000 = ",Number(i==null?void 0:i.rate)*1e3," xu"]}),e.jsx(f,{})]})}),e.jsx(p,{control:r.control,name:"playerId",render:({field:n})=>e.jsxs(g,{children:[e.jsx(d,{children:"Nhân vật"}),e.jsxs(q,{disabled:!t||C,onValueChange:n.onChange,value:n.value,children:[e.jsx(j,{children:e.jsx(A,{children:e.jsx(G,{placeholder:t?C?"Đang tải...":"Chọn nhân vật":"Vui lòng chọn server trước"})})}),e.jsx(U,{children:b==null?void 0:b.map(a=>e.jsx(E,{value:a.UserID.toString(),children:a.NickName},a.UserID))})]}),e.jsx(f,{})]})}),e.jsx(p,{control:r.control,name:"amount",render:({field:n})=>e.jsxs(g,{children:[e.jsxs(d,{children:["Số coin chuyển"," ",n.value&&Number(i==null?void 0:i.rate)&&`( ${Number(n.value)*Number(i==null?void 0:i.rate)}  xu)`]}),e.jsx(j,{children:e.jsx(O,{type:"number",placeholder:`Nhập số coin (${L.toLocaleString()} - ${w.toLocaleString()})`,...n})}),e.jsx(d,{className:"italic text-s text-gray-700 font-medium",children:"**X2 khi nạp lần đầu (tối đa 1,500,000 VND)**"}),e.jsx(d,{className:"italic text-s text-gray-700 font-medium block",children:"**Tối thiếu 600 coin**"}),e.jsx(f,{})]})}),e.jsx(x,{type:"submit",className:"w-full",disabled:r.formState.isSubmitting||C||!t||!r.formState.isValid,children:r.formState.isSubmitting?"Đang xử lý...":"Chuyển coin"})]})})})]})]}),e.jsx(ye,{open:y,onOpenChange:N,children:e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Xác thực chuyển coin"}),e.jsx(ee,{children:"Vui lòng xác nhận thông tin và nhập mã xác thực đã được gửi đến email của bạn"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"text-muted-foreground",children:"Server:"}),e.jsx("div",{className:"font-medium",children:c==null?void 0:c.serverName}),e.jsx("div",{className:"text-muted-foreground",children:"Nhân vật:"}),e.jsx("div",{className:"font-medium",children:c==null?void 0:c.playerName}),e.jsx("div",{className:"text-muted-foreground",children:"Số coin:"}),e.jsx("div",{className:"font-medium",children:(V=c==null?void 0:c.amount)==null?void 0:V.toLocaleString()})]})}),e.jsx(F,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(re),className:"space-y-4",children:[e.jsx(p,{control:l.control,name:"code",render:({field:n})=>e.jsxs(g,{children:[e.jsx(d,{children:"Mã xác thực"}),e.jsx(j,{children:e.jsx(O,{...n,placeholder:"Nhập mã xác thực"})}),e.jsx(f,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>{N(!1),l.reset()},children:"Hủy"}),e.jsx(x,{type:"submit",disabled:l.formState.isSubmitting,children:l.formState.isSubmitting?"Đang xác thực...":"Xác thực"})]})]})})]})})]})};export{Oe as default};
