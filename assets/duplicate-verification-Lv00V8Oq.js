import{r as h,k as w,l as V,j as i,B as m}from"./index-C_l3ICDN.js";import{V as E}from"./verify-form-K5-jcLQH.js";import{b,c as u,V as k,C}from"./verify-status-Pf_o5lYa.js";import{A as N,b as f,a as v}from"./alert-dIrVUsuw.js";import{a as S,c as T,C as A,b as L,d as R}from"./fetch-CghRpjQs.js";import"./input-9AQyrjGS.js";const D=({userInfo:t,isLoading:c,onStartVerification:s})=>i.jsxs(S,{className:"w-full border-none shadow-none",children:[i.jsx(T,{className:"gap-4",children:i.jsx(A,{children:"Thiết lập xác thực email 2 lớp"})}),i.jsx(L,{children:i.jsx(k,{verifyEmail:Number(t==null?void 0:t.VerifiedEmail),actived2fa:Number(t==null?void 0:t["2fa"])})}),!(Number(t==null?void 0:t.VerifiedEmail)===1&&Number(t==null?void 0:t["2fa"])===1)&&i.jsx(R,{className:"flex justify-end",children:i.jsx(m,{onClick:s,disabled:Number(t==null?void 0:t.VerifiedEmail)!==1||c,children:Number(t==null?void 0:t.VerifiedEmail)!==1?"Tiếp tục":c?"Đang gửi...":"Gửi mã xác thực"})})]}),F=()=>i.jsxs(N,{className:"mt-4",children:[i.jsx(C,{className:"h-4 w-4"}),i.jsx(f,{children:"Thành công"}),i.jsx(v,{children:"Email của bạn đã được xác thực 2 lớp."})]}),H=()=>{const[t,c]=h.useState("check"),[s,n]=h.useState(!1),{toast:a}=w(),{userInfo:l,updateUserInfo:d}=V(),{requestDuplicateVerify:o,isLoading:x}=b(),{duplicateVerify:p}=u(),g=async()=>{try{if(await o())c("verify"),a({title:"Mã xác thực đã được gửi",description:"Vui lòng kiểm tra email của bạn"});else throw new Error("Không thể gửi mã xác thực")}catch(e){a({variant:"destructive",title:"Lỗi",description:e instanceof Error?e.message:"Đã có lỗi xảy ra khi gửi mã xác thực"})}},j=async e=>{try{if(!await p({code:e}))throw new Error("Mã xác thực không đúng");d({...l,"2fa":"1"}),n(!0),a({title:"Xác thực thành công",description:"Email của bạn đã được xác thực 2 lớp"}),setTimeout(()=>{c("check"),n(!1)},2e3)}catch(r){a({variant:"destructive",title:"Lỗi",description:r instanceof Error?r.message:"Đã có lỗi xảy ra khi gửi mã xác thực"})}},y=async()=>{try{if(!await o())throw new Error("Không thể gửi lại mã xác thực")}catch(e){a({variant:"destructive",title:"Lỗi",description:e instanceof Error?e.message:"Đã có lỗi xảy ra khi gửi mã xác thực"})}};return i.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] px-[12px] mx-auto mt-[10vh]",children:t==="check"?i.jsx(D,{userInfo:l,isLoading:x,onStartVerification:g}):i.jsxs(i.Fragment,{children:[i.jsx(E,{title:"Xác thực 2 lớp",description:"Bước 2: Trạng thái kích hoạt xác thực email 2 lớp",onSubmit:j,onResend:y,onExpired:()=>c("check")}),s&&i.jsx(F,{}),i.jsx("div",{className:"mt-4 flex justify-center",children:i.jsx(m,{variant:"outline",onClick:()=>c("check"),children:"Quay lại"})})]})})};export{H as default};
