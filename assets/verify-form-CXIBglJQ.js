import{r as o,j as e,B as C,A as E,w as v,x as I,y as N,z as T,E as M,F as V}from"./index-DR-L-TCk.js";import{o as R,s as k,u as O,a as X,t as $,F as L,b as q,c as B,d as G,e as H,I as U,f as W}from"./use-alert-DIoakmlQ.js";import{a as _,c as z,C as K,e as P,b as Y,d as J}from"./card-CqLdpYSs.js";const p=60,S=120,Q=R({verificationCode:k().min(6,{message:"Mã xác thực phải có ít nhất 6 ký tự."})}),re=({title:b="Xác thực",description:y="Vui lòng điền code đã được gửi tới Email của bạn",onSubmit:F,onResend:l,onExpired:d})=>{const[r,h]=o.useState(p),[s,m]=o.useState(S),[x,u]=o.useState(!1),[D,c]=o.useState(!1),f=O(),i=X({resolver:$(Q),defaultValues:{verificationCode:""}});o.useEffect(()=>{let t,a;return r>0&&(t=setInterval(()=>{h(n=>n-1)},1e3)),s>0&&(a=setInterval(()=>{m(n=>(n<=1&&c(!0),n-1))},1e3)),()=>{clearInterval(t),clearInterval(a)}},[r,s]);const g=t=>{const a=Math.floor(t/60),n=t%60;return`${a}:${n.toString().padStart(2,"0")}`},j=async t=>{try{if(s<=0){c(!0);return}await F(t.verificationCode)}catch{f.error("Lỗi","Xác thực thất bại. Vui lòng thử lại.")}},w=async()=>{if(!(r>0||!l))try{u(!0),await l(),h(p),m(S),c(!1)}catch{f.error("Lỗi","Không thể gửi lại mã xác thực")}finally{u(!1)}},A=()=>{d&&d(),c(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{className:"w-full",children:[e.jsxs(z,{children:[e.jsx(K,{children:b}),e.jsxs(P,{children:[y,s>0&&` (mã hết hạn sau: ${g(s)})`]})]}),e.jsx(Y,{children:e.jsx(L,{...i,children:e.jsx("form",{onSubmit:i.handleSubmit(j),className:"space-y-4",children:e.jsx(q,{control:i.control,name:"verificationCode",render:({field:t})=>e.jsxs(B,{children:[e.jsx(G,{children:"Mã xác thực"}),e.jsx(H,{children:e.jsx(U,{placeholder:"Nhập mã xác thực",...t})}),e.jsx(W,{})]})})})})}),e.jsxs(J,{className:"flex justify-between",children:[l&&e.jsx(C,{variant:"outline",onClick:w,disabled:r>0||x,children:x?"Đang gửi...":r>0?`Gửi lại mã (${g(r)})`:"Gửi lại mã"}),e.jsx(C,{onClick:i.handleSubmit(j),disabled:i.formState.isSubmitting||s<=0,children:i.formState.isSubmitting?"Đang xác thực...":"Xác thực"})]})]}),e.jsx(E,{open:D,children:e.jsxs(v,{children:[e.jsxs(I,{children:[e.jsx(N,{children:"Mã xác thực đã hết hạn"}),e.jsx(T,{children:"Mã xác thực của bạn đã hết hạn. Vui lòng thực hiện lại xác thực."})]}),e.jsx(M,{children:e.jsx(V,{onClick:A,children:"Đồng ý"})})]})})]})};export{re as V};
