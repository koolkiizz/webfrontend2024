import{r as d,a as V,j as t,B as x}from"./index-CJ9OkdYx.js";import{V as p}from"./verify-form-BEFxapxz.js";import{b,c as C,V as N,C as S}from"./verify-status-DwbbGafn.js";import{A as f,b as w,a as k}from"./alert-CY6BRpoq.js";import{b as E,d as L,C as T,c as v,f as A}from"./fetch-CZRub33F.js";import{u as R}from"./use-alert-D1fpYyrc.js";const D=({userInfo:i,isLoading:s,onStartVerification:r})=>t.jsxs(E,{className:"w-full border-none shadow-none",children:[t.jsx(L,{className:"gap-4",children:t.jsx(T,{children:"Thiết lập xác thực email 2 lớp"})}),t.jsx(v,{children:t.jsx(N,{verifyEmail:Number(i==null?void 0:i.VerifiedEmail),actived2fa:Number(i==null?void 0:i["2fa"])})}),!(Number(i==null?void 0:i.VerifiedEmail)===1&&Number(i==null?void 0:i["2fa"])===1)&&t.jsx(A,{className:"flex justify-end",children:t.jsx(x,{onClick:r,disabled:Number(i==null?void 0:i.VerifiedEmail)!==1||s,children:Number(i==null?void 0:i.VerifiedEmail)!==1?"Tiếp tục":s?"Đang gửi...":"Gửi mã xác thực"})})]}),F=()=>t.jsxs(f,{className:"mt-4",children:[t.jsx(S,{className:"h-4 w-4"}),t.jsx(w,{children:"Thành công"}),t.jsx(k,{children:"Email của bạn đã được xác thực 2 lớp."})]}),Q=()=>{const[i,s]=d.useState("check"),[r,l]=d.useState(!1),e=R(),{userInfo:m,updateUserInfo:n}=V(),{requestDuplicateVerify:h,isLoading:o}=b(),{duplicateVerify:j}=C(),u=async()=>{try{const c=await h();if(!(c!=null&&c.success)){e.error("Lỗi",c==null?void 0:c.message);return}e.success("Thành công",c==null?void 0:c.message),s("verify")}catch{e.error("Lỗi","Đã có lỗi xảy ra khi gửi mã xác thực")}},g=async c=>{try{const a=await j({code:c});if(!(a!=null&&a.success)){e.error("Lỗi",a==null?void 0:a.message);return}n({...m,"2fa":"1"}),l(!0),e.success("Xác thực thành công",a==null?void 0:a.message),setTimeout(()=>{s("check"),l(!1)},2e3)}catch{e.error("Lỗi","Đã có lỗi xảy ra khi xác thực")}},y=async()=>{try{const c=await h();if(!(c!=null&&c.success)){e.error("Lỗi",c==null?void 0:c.message);return}e.success("Đã gửi lại mã",c==null?void 0:c.message)}catch{e.error("Lỗi","Không thể gửi lại mã xác thực")}};return t.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] px-[12px] mx-auto mt-[10vh]",children:i==="check"?t.jsx(D,{userInfo:m,isLoading:o,onStartVerification:u}):t.jsxs(t.Fragment,{children:[t.jsx(p,{title:"Xác thực 2 lớp",description:"Bước 2: Trạng thái kích hoạt xác thực email 2 lớp",onSubmit:g,onResend:y,onExpired:()=>s("check")}),r&&t.jsx(F,{}),t.jsx("div",{className:"mt-4 flex justify-center",children:t.jsx(x,{variant:"outline",onClick:()=>s("check"),children:"Quay lại"})})]})})};export{Q as default};
