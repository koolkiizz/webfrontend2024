import{r as m,k as y,l as E,j as i,B as d}from"./index-DH1O9ZzT.js";import{V}from"./verify-form-D3azSHES.js";import{u as v,a as w,V as h}from"./verify-status--y09G2xX.js";import{a as j,b}from"./fetch-DQ2hXI7j.js";import"./input-Dgth415u.js";const k=({onRequestVerify:c,isLoading:t,verifyEmail:n,actived2fa:a})=>i.jsxs("div",{className:"space-y-6",children:[i.jsx(h,{verifyEmail:n,actived2fa:a}),i.jsx(j,{className:"w-full border-none shadow-none",children:i.jsx(b,{className:"pt-6",children:i.jsx(d,{className:"w-full",onClick:c,disabled:t,children:t?"Đang gửi mã xác thực...":"Yêu cầu mã xác thực email"})})})]}),B=()=>{const[c,t]=m.useState("check"),[n,a]=m.useState(!1),{toast:r}=y(),{userInfo:e,updateUserInfo:x}=E(),{verifyEmail:u}=v(),{requestVerifyEmail:l}=w(),p=async()=>{try{if(a(!0),await l())r({title:"Mã xác thực đã được gửi",description:"Vui lòng kiểm tra email của bạn"}),t("verify");else throw new Error("Không thể gửi mã xác thực")}catch(s){r({variant:"destructive",title:"Lỗi",description:s instanceof Error?s.message:"Đã có lỗi xảy ra khi gửi mã xác thực"})}finally{a(!1)}},f=async s=>{try{if(!await u({code:s}))throw new Error("Mã xác thực không đúng");r({title:"Xác thực thành công",description:"Email của bạn đã được xác thực"}),x({...e,VerifiedEmail:"1"}),t("check")}catch(o){r({variant:"destructive",title:"Lỗi",description:o instanceof Error?o.message:"Đã có lỗi xảy ra khi gửi mã xác thực"})}},g=async()=>{if(!await l())throw new Error("Không thể gửi lại mã xác thực")};return Number(e==null?void 0:e.VerifiedEmail)!==0?i.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] mx-auto mt-[10vh] rounded-lg px-[12px]",children:i.jsx(h,{verifyEmail:Number(e==null?void 0:e.VerifiedEmail),actived2fa:Number(e==null?void 0:e["2fa"])})}):i.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] mx-auto mt-[10vh] rounded-lg px-[12px]",children:c==="check"?i.jsx(k,{onRequestVerify:p,isLoading:n,verifyEmail:Number(e==null?void 0:e.VerifiedEmail),actived2fa:Number(e==null?void 0:e["2fa"])}):i.jsxs(i.Fragment,{children:[i.jsx(V,{title:"Xác nhận Email",description:"Vui lòng điền code đã được gửi tới Email của bạn",onSubmit:f,onResend:g,onExpired:()=>t("check")}),i.jsx("div",{className:"mt-4 flex justify-center",children:i.jsx(d,{variant:"outline",onClick:()=>t("check"),children:"Quay lại"})})]})})};export{B as default};
