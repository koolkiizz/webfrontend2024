import{r as l,k as q,l as R,j as e,B as d}from"./index-Bn_bHuoN.js";import{u as B,L as F,I as G}from"./input-C4CD33dg.js";import{b as H,c as O,V as U,C as p,d as K}from"./useVerify-_nvSorQn.js";import{A as o,a as h,b as f}from"./alert-CDMOHtT0.js";import{C as w,a as y,b as k,d as S,e as V,c as Q}from"./card-DIz8FuQ8.js";import"./fetch-CWuzVEnS.js";const W=120,$=()=>{const[T,m]=l.useState("check"),[x,s]=l.useState("idle"),[t,j]=l.useState(0),{toast:c}=q(),{userInfo:i,updateUserInfo:E}=R(),{requestDuplicateVerify:L,isLoading:r}=H(),{duplicateVerify:A,isLoading:u}=O(),{register:D,handleSubmit:v,formState:{errors:g},reset:b}=B();l.useEffect(()=>{let a;return t>0&&(a=setInterval(()=>{j(n=>(n<=1&&s("timeout"),n-1))},1e3)),()=>clearInterval(a)},[t]);const C=async()=>{try{await L()?(m("verify"),j(W),s("idle"),b(),c({title:"Mã xác thực đã được gửi",description:"Vui lòng kiểm tra email của bạn"})):c({variant:"destructive",title:"Lỗi",description:"Không thể gửi mã xác thực"})}catch{c({variant:"destructive",title:"Lỗi",description:"Đã có lỗi xảy ra khi gửi mã xác thực"})}},N=async a=>{if(t<=0){s("timeout");return}try{await A({code:a.verificationCode})?(s("success"),E({...i,"2fa":"1"}),c({title:"Xác thực thành công",description:"Email của bạn đã được xác thực 2 lớp"}),setTimeout(()=>m("check"),2e3)):(s("error"),c({variant:"destructive",title:"Xác thực thất bại",description:"Mã xác thực không đúng"}))}catch{s("error"),c({variant:"destructive",title:"Lỗi",description:"Đã có lỗi xảy ra khi xác thực"})}},M=async()=>{t>0||await C()},X=()=>{m("check"),s("idle"),b()};return T==="check"?e.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] px-[12px] mx-auto mt-[10vh]",children:e.jsxs(w,{className:"w-full border-none shadow-none",children:[e.jsx(y,{className:"gap-4",children:e.jsx(k,{children:"Thiết lập xác thực email 2 lớp"})}),e.jsx(S,{children:e.jsx(U,{verifyEmail:Number(i==null?void 0:i.VerifiedEmail),actived2fa:Number(i==null?void 0:i["2fa"])})}),e.jsx(V,{className:"flex justify-end",children:e.jsx(d,{onClick:C,disabled:Number(i==null?void 0:i.VerifiedEmail)!==1||r,children:Number(i==null?void 0:i.VerifiedEmail)!==1?"Tiếp tục":r?"Đang gửi...":"Gửi mã xác thực"})})]})}):e.jsx("div",{className:"md:min-w-[500px] md:max-w-[600px] px-[12px] mx-auto mt-[10vh]",children:e.jsxs(w,{className:"w-full border-none shadow-none",children:[e.jsxs(y,{children:[e.jsx(k,{children:"Xác thực 2 lớp"}),e.jsx(Q,{children:"Bước 2: Trạng thái kích hoạt xác thực email 2 lớp"})]}),e.jsxs(S,{children:[e.jsxs("form",{onSubmit:v(N),className:"space-y-4",children:[e.jsx("div",{className:"grid w-full items-center gap-4",children:e.jsxs("div",{className:"flex flex-col space-y-1.5",children:[e.jsx(F,{htmlFor:"verificationCode",children:"Xác thực code"}),e.jsx(G,{id:"verificationCode",placeholder:"Nhập mã số",...D("verificationCode",{required:"Xác thực code là bắt buộc"})}),g.verificationCode&&e.jsxs(o,{variant:"destructive",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx(h,{children:g.verificationCode.message})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Thời gian còn lại: ",Math.floor(t/60),":",(t%60).toString().padStart(2,"0")]}),t<=0&&e.jsx(d,{type:"button",variant:"outline",onClick:M,disabled:r,children:r?"Đang gửi...":"Gửi lại mã"})]})]}),x==="success"&&e.jsxs(o,{className:"mt-4",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx(f,{children:"Thành công"}),e.jsx(h,{children:"Email của bạn đã được xác thực 2 lớp."})]}),x==="error"&&e.jsxs(o,{variant:"destructive",className:"mt-4",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx(f,{children:"Thất bại"}),e.jsx(h,{children:"Mã xác thực không đúng. Vui lòng thử lại."})]}),x==="timeout"&&e.jsxs(o,{variant:"destructive",className:"mt-4",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx(f,{children:"Hết giờ"}),e.jsx(h,{children:"Mã xác thực đã hết hạn. Vui lòng nhấn gửi lại mã."})]})]}),e.jsxs(V,{className:"flex justify-between",children:[e.jsx(d,{variant:"outline",onClick:X,disabled:u,children:"Quay lại"}),e.jsx(d,{onClick:v(N),disabled:u||t<=0,children:u?"Đang xác thực...":"Xác thực"})]})]})})};export{$ as default};
