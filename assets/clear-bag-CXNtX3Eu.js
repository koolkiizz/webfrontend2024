import{r as x,j as r,B as j}from"./index-neaKrv17.js";import{o as _,s as v,u as D,a as M,F as X,b as f,c as C,d as S,e as y,f as p,t as G}from"./use-alert-DM6nFZOr.js";import{V as U}from"./verify-form-Cq7kRNyl.js";import{b as A,d as H,C as K,f as b,c as Q}from"./utils-BD3ftINz.js";import{S as I,a as V,b as q,c as L,d as w}from"./select-CliqWFZG.js";import{u as B,e as F}from"./fetch-Cb1DhwTR.js";import{u as z,a as J}from"./usePlayer-iJht8TD_.js";function O(){const{executePost:a,isLoading:l,isError:n}=B(F.requestClearBag());return{requestClearBag:async i=>{try{return await a(i)}catch{throw new Error("error")}},isLoading:l,isError:n}}function W(){const{executePost:a,isLoading:l,isError:n}=B(F.validClearBag());return{validClearBag:async i=>{try{return await a(i)}catch{throw new Error("error")}},isLoading:l,isError:n}}const Y=_({serverId:v({required_error:"Vui lòng chọn server"}),playerId:v({required_error:"Vui lòng chọn nhân vật"})}),ne=()=>{const a=D(),[l,n]=x.useState("request"),[o,i]=x.useState(""),{serverData:c,isLoading:h}=z(!0),{playerData:d,isLoading:u}=J(o,!1),{requestClearBag:m,isLoading:g}=O(),{validClearBag:E}=W(),t=M({resolver:G(Y),defaultValues:{serverId:"",playerId:""}}),k=s=>{i(s),t.setValue("serverId",s),t.setValue("playerId","")},N=async s=>{try{const e=await m({server_id:s.serverId,player_id:s.playerId});if(!(e!=null&&e.success)){a.error("Lỗi",e==null?void 0:e.message);return}n("verify"),a.success("Thành công",e==null?void 0:e.message)}catch(e){a.error("Lỗi",e instanceof Error?e.message:"Đã có lỗi xảy ra")}},P=async s=>{try{const e=await E({code:s});if(!(e!=null&&e.success)){a.error("Lỗi",e==null?void 0:e.message);return}t.reset(),i(""),n("request"),a.success("Thành công",e==null?void 0:e.message)}catch(e){a.error("Lỗi",e instanceof Error?e.message:"Mã xác thực không đúng")}},T=async()=>{try{const s=t.getValues(),e=await m({server_id:s.serverId,player_id:s.playerId});if(!(e!=null&&e.success)){a.error("Lỗi",e==null?void 0:e.message);return}a.success("Thành công",e==null?void 0:e.message)}catch(s){a.error("Lỗi",s instanceof Error?s.message:"Không thể gửi lại mã xác thực")}},R=()=>{n("request"),t.reset(),i("")};return l==="verify"?r.jsxs("div",{className:"container mx-auto max-w-md py-8",children:[r.jsx(U,{title:"Xác thực xóa mật khẩu túi đồ",description:"Vui lòng nhập mã xác thực đã được gửi đến email của bạn",onSubmit:P,onResend:T,onExpired:R}),r.jsx("div",{className:"mt-4 flex justify-center",children:r.jsx(j,{variant:"outline",onClick:()=>{n("request")},children:"Quay lại"})})]}):r.jsx("div",{className:"container mx-auto max-w-2xl py-8",children:r.jsxs(A,{children:[r.jsxs(H,{children:[r.jsx(K,{children:"Xóa mật khẩu túi đồ"}),r.jsx(b,{children:"Mật khẩu rương và câu hỏi bảo mật sẽ bị xóa khi thực hiện hành động này."}),r.jsx(b,{children:"Người chơi cần tải lại game khi tiến hành xóa mật khẩu."})]}),r.jsx(Q,{children:r.jsx(X,{...t,children:r.jsxs("form",{onSubmit:t.handleSubmit(N),className:"space-y-6",id:"clear-bag",children:[r.jsx(f,{control:t.control,name:"serverId",render:({field:s})=>r.jsxs(C,{children:[r.jsx(S,{children:"Server"}),r.jsxs(I,{disabled:h,onValueChange:k,value:s.value,children:[r.jsx(y,{children:r.jsx(V,{children:r.jsx(q,{placeholder:h?"Đang tải...":"Chọn server"})})}),r.jsx(L,{children:c==null?void 0:c.map(e=>r.jsx(w,{value:e.ServerID.toString(),children:e.ServerName},e.ServerID))})]}),r.jsx(p,{})]})}),r.jsx(f,{control:t.control,name:"playerId",render:({field:s})=>r.jsxs(C,{children:[r.jsx(S,{children:"Nhân vật"}),r.jsxs(I,{disabled:!o||u,onValueChange:s.onChange,value:s.value,children:[r.jsx(y,{children:r.jsx(V,{children:r.jsx(q,{placeholder:o?u?"Đang tải...":"Chọn nhân vật":"Vui lòng chọn server trước"})})}),r.jsx(L,{children:d==null?void 0:d.map(e=>r.jsx(w,{value:e.UserID.toString(),children:e.NickName},e.UserID))})]}),r.jsx(p,{})]})}),r.jsx(j,{type:"submit",className:"w-full",form:"clear-bag",disabled:t.formState.isSubmitting||u||!o||!t.formState.isValid||g,children:g?"Đang xử lý...":"Xóa mật khẩu rương"})]})})})]})})};export{ne as default};
